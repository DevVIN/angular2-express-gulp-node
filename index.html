<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Angular2-Express-Node-Gulp by moizKachwala</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Angular2-Express-Node-Gulp</h1>
      <h2 class="project-tagline">Angular 2 - Quick start application with Express + Gulp + Type Script + Node</h2>
      <a href="https://github.com/moizKachwala/angular2-express" class="btn">View on GitHub</a>
      <a href="https://github.com/moizKachwala/angular2-express/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/moizKachwala/angular2-express/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="angular2-gulp-typescript-nodejs-and-express" class="anchor" href="#angular2-gulp-typescript-nodejs-and-express" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Angular2 Gulp, Typescript, NodeJS and Express</h1>

<h2>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Introduction</h2>

<p>Basic Angular seed application created with Quick start application given on angular website (<a href="https://angular.io/docs/ts/latest/quickstart.html">https://angular.io/docs/ts/latest/quickstart.html</a>). It uses Typescript, Gulp for tasks like build, compile, install etc and ExpressJS as server. The application basically involve both client(Angular2) and server(Express and Node).</p>

<p><a href="https://github.com/moizKachwala/angular2-express">Github Directory - https://github.com/moizKachwala/angular2-express</a></p>

<h2>
<a id="getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Getting Started</h2>

<p>Before we start make sure you have NodeJS installed in your machine.If not then you can download and install NodeJS from (<a href="https://nodejs.org/en/">https://nodejs.org/en/</a>)</p>

<p>You need to install typings globally by following command. </p>

<p><code>npm install --global typings</code></p>

<h2>
<a id="project-setup" class="anchor" href="#project-setup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Project Setup</h2>

<p>Create a new directory and install dependencies. This will create a folder and will add the package.json in the folder.</p>

<pre><code>mkdir Angular2-express
cd Angular2-express
npm init -y
</code></pre>

<p>Now Add dependencies to your package.json.</p>

<pre><code>"dependencies": {
    "angular2": "^2.0.0-beta.17",
    "es6-promise": "^3.2.1",
    "es6-shim": "^0.35.1",
    "express": "^4.13.4",
    "gulp-concat": "^2.6.0",
    "reflect-metadata": "^0.1.2",
    "rxjs": "^5.0.0-beta.6",
    "systemjs": "^0.19.29",
    "zone": "^0.3.4"
  }
</code></pre>

<p>And your dev dependencies.</p>

<pre><code> "devDependencies": {
    "concurrently": "^2.1.0",
    "del": "^2.2.0",
    "gulp": "^3.9.1",
    "gulp-concat": "^2.6.0",
    "gulp-nodemon": "^2.1.0",
    "gulp-sourcemaps": "^1.6.0",
    "gulp-tslint": "^4.3.3",
    "gulp-typescript": "^2.13.6",
    "gulp-typings": "^2.0.0",
    "run-sequence": "^1.2.1",
    "tslint": "^3.5.0"
  }
</code></pre>

<p>Now install all the dependencies by opening the created folder in command prompt and fire following command.</p>

<p><code>npm install</code></p>

<p>Once you have done <code>npm install</code>, you will find a node_modules folder in your directory. This holds all the dependencies that we added in package.json. Now create a file <strong>gulpfile.ts</strong> and  two folders in your project <strong>client</strong> and <strong>server</strong>.</p>

<p>Our folder structure will look something like this.</p>

<pre><code>angular2-express
      |-- node_modules
      |-- client
      |-- server
      gulpfile.ts
      package.json

</code></pre>

<p>Now as we have taken gulpfile.ts we need to tell how to compile the ts file by adding tsconfig.json. This also set the outDir which we will be handling later. We have also added exclude option so we don't want typescript to go and compile those directives/files.</p>

<pre><code>{
  "compilerOptions": {
    "outDir": "build/app",
    "target": "es5",
    "module": "system",
    "moduleResolution": "node",
    "sourceMap": true,
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "removeComments": false,
    "noImplicitAny": false
  },
  "exclude": [
    "node_modules",
    "typings",
    "typings/index.d.ts"
  ]
}

</code></pre>

<p>So now we have done with the basic structure we will start implementing Server for our application.</p>

<h2>
<a id="server-setup" class="anchor" href="#server-setup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Server Setup</h2>

<p>First thing we need to do is create a tsconfig.json inside server folder.This will tell our typescript compiler how to compile our .ts extension files.</p>

<p>Let's create tsconfig.json in /server folder with following content.</p>

<pre><code>{
  "compilerOptions": {
    "target": "ES5",
    "module": "commonjs",
    "sourceMap": true,
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "removeComments": false,
    "noImplicitAny": false
  },
  "exclude": [
    "typings"
  ]
}

</code></pre>

<p>In our server directory, We need to add <strong>typings.json</strong>. Typings is the simple way to manage and install TypeScript definitions.</p>

<pre><code>{
  "globalDependencies": {
    "express": "registry:dt/express#4.0.0+20160317120654",
    "express-serve-static-core": "registry:dt/express-serve-static-core#0.0.0+20160602151406",
    "mime": "registry:dt/mime#0.0.0+20160316155526",
    "node": "registry:dt/node#6.0.0+20160608083720",
    "serve-static": "registry:dt/serve-static#0.0.0+20160606155157"
  }
}

</code></pre>

<p>Now go to command prompt, and navigate to server folder and execute the following command. This will install the typescript definations for our server.</p>

<p><code>typings install</code></p>

<p>You will notice that it created a directory <strong>typings</strong> inside <strong>/server</strong> directory</p>

<p>Now lets create <strong>server.ts</strong> inside /server directory.</p>

<pre><code>import express = require('express');
import path = require('path');
var port: number = process.env.PORT || 3000;
var app = express();

app.use('/app', express.static(path.resolve(__dirname, 'app')));
app.use('/libs', express.static(path.resolve(__dirname, 'libs')));

var renderIndex = (req: express.Request, res: express.Response) =&gt; {
    res.sendFile(path.resolve(__dirname, 'index.html'));
}

app.get('/*', renderIndex);

var server = app.listen(port, function() {
    var host = server.address().address;
    var port = server.address().port;
    console.log('This express app is listening on port:' + port);
});

</code></pre>

<ul>
<li>The server will run on port 3000</li>
<li>We have made <strong>app</strong> and <strong>lib</strong> folders as static content folder.</li>
<li>All the routes will be served by index.html</li>
<li>
<strong>app</strong> folder will hold all the files related to angular2 and <strong>libs</strong> folder will hold all the dependencies. Don't worry we will create this folders in some time.</li>
</ul>

<p>We are done with the server side work. Our directory structure will look like this.</p>

<pre><code>angular2-express
      |-- node_modules
      |-- client
      |-- server
           |-- typings
           |-- server.ts
           |-- tsconfig.json
           |-- typings.json
      gulpfile.ts
      package.json
      tsconfig.json

</code></pre>

<h2>
<a id="client-setup" class="anchor" href="#client-setup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Client Setup</h2>

<p>Let's drive the Client Side Application with Angular2.</p>

<p>In /client directory add <strong>index.html</strong></p>

<pre><code>&lt;html&gt;

  &lt;head&gt;
    &lt;title&gt;Angular 2 Quickstart with Express&lt;/title&gt;
    &lt;base href="/"/&gt;

    &lt;!-- 1. Load libraries --&gt;
    &lt;script src="libs/angular2/bundles/angular2-polyfills.js"&gt;&lt;/script&gt;
    &lt;script src="libs/systemjs/dist/system.src.js"&gt;&lt;/script&gt;
    &lt;script src="libs/rxjs/bundles/Rx.js"&gt;&lt;/script&gt;
    &lt;script src="libs/angular2/bundles/angular2.dev.js"&gt;&lt;/script&gt;
    &lt;script src="libs/angular2/bundles/router.dev.js"&gt;&lt;/script&gt;

    &lt;!-- 2. Configure SystemJS --&gt;
    &lt;script&gt;
      System.config({
        packages: {        
          app: {
            format: 'register',
            defaultExtension: 'js'
          }
        }
      });
      System.import('app/main')
            .then(null, console.error.bind(console));
    &lt;/script&gt;

  &lt;/head&gt;
  &lt;!-- 3. Display the application --&gt;
  &lt;body&gt;
    &lt;my-app&gt;Loading...&lt;/my-app&gt;
  &lt;/body&gt;

&lt;/html&gt;

</code></pre>

<ul>
<li>This is the basic startup file for the angular application</li>
<li>Notice System.config in index.html. This will tell angular to load module based scripts in the browser.</li>
<li>There are libs included in the file which will load some of the core dependencies for our angular application.</li>
</ul>

<p>As we are developing our application in Typescript, we need to add <strong>tsconfig.json</strong></p>

<pre><code>{
  "compilerOptions": {
    "target": "ES5",
    "module": "system",
    "moduleResolution": "node",
    "sourceMap": true,
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "removeComments": false,
    "noImplicitAny": false
  },
  "exclude": [
    "typings"
  ]
}
</code></pre>

<p>We will also need some typings to be installed for our application. Add <strong>typings.json</strong> like we added for server</p>

<pre><code>{
  "globalDependencies": {
    "es6-shim": "registry:dt/es6-shim#0.31.2+20160602141504"
  }
}
</code></pre>

<p>Once you have added typings.json we need to install typings for our client application. Navigate to client folder in command prompt and run following command.</p>

<p><code>typings install</code></p>

<h2>
<a id="angular2-code" class="anchor" href="#angular2-code" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Angular2 Code</h2>

<p>Now let's start adding our angular code.  create a directory named <em>app</em> inside <em>/client</em> folder.</p>

<h3>
<a id="note--i-am-just-going-to-cover-the-basic-angular-code-from-quick-start-application-the-main-agenda-for-this-post-is-to-use-angular-with-express-server-please-go-to-my-github-to-get-the-finished-angular-quick-start-application" class="anchor" href="#note--i-am-just-going-to-cover-the-basic-angular-code-from-quick-start-application-the-main-agenda-for-this-post-is-to-use-angular-with-express-server-please-go-to-my-github-to-get-the-finished-angular-quick-start-application" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Note : I am just going to cover the basic angular code from quick start application. The main agenda for this post is to use angular with Express server. Please go to my <a href="https://github.com/moizKachwala/angular2-express">github</a> to get the finished angular Quick start application.</h3>

<p>Now in <em>/client/app</em>, Create our first component <em>app.component.ts</em>. This is our root component for our application</p>

<pre><code>import {Component} from 'angular2/core';
@Component({
  selector: 'my-app',
  template: '&lt;h1&gt;My First Angular 2 App&lt;/h1&gt;'
})
export class AppComponent { }

</code></pre>

<p>Now we need to add a bootstrap class which will initialize our application. Add <em>main.ts</em> inside /app directory.</p>

<pre><code>import {bootstrap} from 'angular2/platform/browser';

import {AppComponent} from './app.component';

bootstrap(AppComponent);
</code></pre>

<p>Till this point our project structure should look like this.</p>

<pre><code>angular2-express
      |-- node_modules
      |-- client
           |-- app
                |-- app.component.ts
                |-- main.ts
           |-- typings
           |-- index.html
           |-- tsconfig.json
           |-- typings.json
      |-- server
           |-- typings
           |-- server.ts
           |-- tsconfig.json
           |-- typings.json
      gulpfile.ts
      package.json
      tsconfig.json
</code></pre>

<h2>
<a id="gulpfile-task-management" class="anchor" href="#gulpfile-task-management" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>GulpFile (Task Management)</h2>

<p>Now we have our client and server setup we need to add a root file which would clean, compile and build our application. Modify <strong>gulpfile.ts</strong></p>

<pre><code>"use strict";

const gulp = require("gulp"),
        del = require("del"),
        tsc = require("gulp-typescript"),
        sourcemaps = require('gulp-sourcemaps'),
        tsProject = tsc.createProject("tsconfig.json"),
        tslint = require('gulp-tslint'),
        concat = require('gulp-concat'),
        runSequence = require('run-sequence'),
        nodemon = require('gulp-nodemon'),
        gulpTypings = require("gulp-typings");

/**
 * Remove build directory.
 */
gulp.task('clean', (cb) =&gt; {
    return del(["build"], cb);
});

/**
 * Build Express server
 */
gulp.task('build:server', function () {
    var tsProject = tsc.createProject('server/tsconfig.json');
    var tsResult = gulp.src('server/**/*.ts')
        .pipe(sourcemaps.init())
        .pipe(tsc(tsProject))
    return tsResult.js
        .pipe(concat('server.js'))
        .pipe(sourcemaps.write())
        .pipe(gulp.dest('build'))
});

gulp.task('build:client', function(){
    var tsProject = tsc.createProject('client/tsconfig.json');
    var tsResult = gulp.src('client/**/*.ts')
        .pipe(sourcemaps.init())
        .pipe(tsc(tsProject))
    return tsResult.js
        .pipe(sourcemaps.write())
        .pipe(gulp.dest('build'))
});

/**
 * Lint all custom TypeScript files.
 */
gulp.task('tslint', () =&gt; {
    return gulp.src("client/app/**/*.ts")
        .pipe(tslint())
        .pipe(tslint.report('prose'));
});


/**
 * Compile TypeScript sources and create sourcemaps in build directory.
 */
gulp.task("compile", ["tslint"], () =&gt; {
    let tsResult = gulp.src("client/**/*.ts")
        .pipe(sourcemaps.init())
        .pipe(tsc(tsProject));
    return tsResult.js
        .pipe(sourcemaps.write("."))
        .pipe(gulp.dest("build"));
});

/**
 * Copy all resources that are not TypeScript files into build directory.
 */
gulp.task("resources", () =&gt; {
    return gulp.src(["client/**/*", "!**/*.ts"])
        .pipe(gulp.dest("build"));
});

/**
 * Copy all required libraries into build directory.
 */
gulp.task("libs", () =&gt; {
    return gulp.src([
        'angular2/bundles/angular2-polyfills.js',
        'systemjs/dist/system.src.js',
        'rxjs/bundles/Rx.js',
        'angular2/bundles/angular2.dev.js',
        'angular2/bundles/router.dev.js'
    ], {cwd: "node_modules/**"}) /* Glob required here. */
        .pipe(gulp.dest("build/libs"));
});

/**
 * Watch for changes in TypeScript, HTML and CSS files.
 */
gulp.task('watch', function () {
    gulp.watch(["client/**/*.ts"], ['compile']).on('change', function (e) {
        console.log('TypeScript file ' + e.path + ' has been changed. Compiling.');
    });
    gulp.watch(["client/**/*.html", "client/**/*.css"], ['resources']).on('change', function (e) {
        console.log('Resource file ' + e.path + ' has been changed. Updating.');
    });
});

/**
 * Install typings for server and client.
 */
gulp.task("installTypings",function(){
    var stream = gulp.src(["./server/typings.json","./client/typings.json"])
        .pipe(gulpTypings(null)); //will install all typingsfiles in pipeline.
    return stream; // by returning stream gulp can listen to events from the stream and knows when it is finished.
});

/**
 * Start the express server with nodemon
 */
gulp.task('start', function () {
    nodemon({ script: 'build/server.js'
        , ext: 'html js'
        , ignore: ['ignored.js']
        , tasks: ['tslint'] })
        .on('restart', function () {
            console.log('restarted!')
        });
});

/**
 * Build the project.
 * 1. Clean the build directory
 * 2. Build Express server
 * 3. Build the Angular app
 * 4. Copy the resources
 * 5. Copy the dependencies.
 */

gulp.task("build", function (callback) {
    runSequence('clean', 'build:server', 'build:client', 'resources', 'libs', callback);
});

</code></pre>

<ul>
<li>Gulpfile handles many tasks.</li>
<li>Clean - clean the build directory</li>
<li>Compile - compile the .ts files and generate .js and .map files.</li>
<li>Build:server - Build our server.ts</li>
<li>Build:client - Build our angular application.</li>
<li>Watch - Watch for the changes.</li>
<li>Start - It uses nodemon for running the server. The benefit of running this is it will automatically restart the server when there is any change in the code.</li>
<li>tslint - this will run the code against some best practices.</li>
</ul>

<h2>
<a id="running-the-code" class="anchor" href="#running-the-code" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Running the code</h2>

<pre><code>npm install
npm build
npm start
</code></pre>

<h2>
<a id="ts-lint" class="anchor" href="#ts-lint" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Ts Lint</h2>

<p>Create a file <strong>tslint.json</strong> in the root directory.</p>

<pre><code>{
  "rules": {
    "class-name": true,
    "curly": true,
    "eofline": false,
    "forin": true,
    "indent": [
      true,
      4
    ],
    "label-position": true,
    "label-undefined": true,
    "max-line-length": [
      true,
      200
    ],
    "no-arg": true,
    "no-bitwise": true,
    "no-console": [
      true,
      "debug",
      "info",
      "time",
      "timeEnd",
      "trace"
    ],
    "no-construct": true,
    "no-debugger": true,
    "no-duplicate-key": true,
    "no-duplicate-variable": true,
    "no-empty": false,
    "no-eval": true,
    "no-string-literal": false,
    "no-trailing-whitespace": true,
    "no-unused-variable": false,
    "no-unreachable": true,
    "no-use-before-declare": true,
    "one-line": [
      true,
      "check-open-brace",
      "check-catch",
      "check-else",
      "check-whitespace"
    ],
    "radix": true,
    "semicolon": true,
    "triple-equals": [
      true,
      "allow-null-check"
    ],
    "variable-name": false,
    "whitespace": [
      true,
      "check-branch",
      "check-decl",
      "check-operator",
      "check-separator"
    ]
  }
}
</code></pre>

<p>The final project structure will look like this.</p>

<pre><code>angular2-express
      |-- node_modules
      |-- client
           |-- app
                |-- app.component.ts
                |-- main.ts
           |-- typings
           |-- index.html
           |-- tsconfig.json
           |-- typings.json
      |-- server
           |-- typings
           |-- server.ts
           |-- tsconfig.json
           |-- typings.json
      gulpfile.ts
      package.json
      tsconfig.json
      tslint.json
</code></pre>

<h2>
<a id="finally" class="anchor" href="#finally" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Finally</h2>

<p>Stay tuned for adding mongoDB support in this application.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/moizKachwala/angular2-express">Angular2-Express-Node-Gulp</a> is maintained by <a href="https://github.com/moizKachwala">moizKachwala</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
